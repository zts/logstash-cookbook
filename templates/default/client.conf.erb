# Basic logstash server config
input {
<% @inputs.each do |i| -%>
  <%= i[:kind] %> {
    <% i[:params].each do |k,v| -%>
    <% if v.is_a?String -%>
      <%= k %> => "<%= v %>"
    <% else -%>
      <%= k %> => <%= v %>
    <% end -%>
    <% end -%>
  }
<% end -%>
}

filter {
<% @filters.each do |i| -%>
  <%= i[:kind] %> {
    <% i[:params].each do |k,v| -%>
    <% if v.is_a?String -%>
      <%= k %> => "<%= v %>"
    <% else -%>
      <%= k %> => <%= v %>
    <% end -%>
    <% end -%>
  }
<% end -%>
}

output {
  # Emit events to stdout for easy debugging of what is going through
  # logstash.
  # stdout { }

  amqp {
    <% amqp = node['logstash']['amqp'] %>
    host => "<%= amqp['host'] %>"
    port => "<%= amqp['port'] %>"
    exchange_type => "<%= amqp['exchange_type'] %>"
    name => "logstash"
  }
}
